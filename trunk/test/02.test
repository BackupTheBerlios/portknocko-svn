###### LOAD WITH SECRET! ######
SECRET="whatasecret"

load

rule "SSH" "2000,2001" "22" "--secure $SECRET"
expect "SSH,(A)" 

knock_udp "11.10.0.1" "22"  
expect "!PASS OK"
knock_udp "11.10.0.1" "2000"
expect "!MATCHING"
knock_udp "11.10.0.1" "2001"
expect "!MATCHING,!ALLOWED"
knock_udp "11.10.0.1" "22"
expect "!PASS OK"

#bad secret
set_hmac "qweasdzxc" "11.10.0.1" 

knock_udp "11.10.0.1" "2000"
expect "!MATCHING"

#bad ipsrc
set_hmac $SECRET "12.10.0.1" 

knock_udp "11.10.0.1" "2000"
expect "!MATCHING"

# GOOD!
set_hmac $SECRET "11.10.0.1" 

knock_udp "11.10.0.1" "2000"
expect "MATCHING"
knock_udp "11.10.0.1" "2001"
expect "ALLOWED"
knock_udp "11.10.0.1" "22"
expect "PASS OK"

unload
#################################
