<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Locking in the Linux Kernel</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Unreliable Guide To Locking"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="The Problem With Concurrency"
HREF="c27.html"><LINK
REL="NEXT"
TITLE="Locks and Uniprocessor Kernels"
HREF="x111.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Unreliable Guide To Locking</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c27.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x111.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="locks"
></A
>Chapter 3. Locking in the Linux Kernel</H1
><P
>&#13;     If I could give you one piece of advice: never sleep with anyone
     crazier than yourself.  But if I had to give you advice on
     locking: <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>keep it simple</I
></SPAN
>.
   </P
><P
>&#13;     Be reluctant to introduce new locks.
   </P
><P
>&#13;     Strangely enough, this last one is the exact reverse of my advice when
     you <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>have</I
></SPAN
> slept with someone crazier than yourself.
     And you should think about getting a big dog.
   </P
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="lock-intro"
>3.1. Two Main Types of Kernel Locks: Spinlocks and Semaphores</A
></H1
><P
>&#13;     There are three main types of kernel locks.  The fundamental type
     is the spinlock 
     (<TT
CLASS="filename"
>include/asm/spinlock.h</TT
>),
     which is a very simple single-holder lock: if you can't get the 
     spinlock, you keep trying (spinning) until you can.  Spinlocks are 
     very small and fast, and can be used anywhere.
   </P
><P
>&#13;     The second type is a mutex
     (<TT
CLASS="filename"
>include/linux/mutex.h</TT
>): it
     is like a spinlock, but you may block holding a mutex.
     If you can't lock a mutex, your task will suspend itself, and be woken
     up when the mutex is released.  This means the CPU can do something
     else while you are waiting.  There are many cases when you simply
     can't sleep (see <A
HREF="c551.html"
>Chapter 9</A
>), and so have to
     use a spinlock instead.
   </P
><P
>&#13;     The third type is a semaphore
     (<TT
CLASS="filename"
>include/asm/semaphore.h</TT
>): it
     can have more than one holder at any time (the number decided at
     initialization time), although it is most commonly used as a
     single-holder lock (a mutex).  If you can't get a semaphore, your
     task will be suspended and later on woken up - just like for mutexes.
   </P
><P
>&#13;     Neither type of lock is recursive: see
     <A
HREF="c414.html#deadlock"
>Section 7.1</A
>.
   </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c27.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x111.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>The Problem With Concurrency</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Locks and Uniprocessor Kernels</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>