<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>What Functions Are Safe To Call From Interrupts?</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Unreliable Guide To Locking"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Data Which Mostly Used By An IRQ Handler"
HREF="x543.html"><LINK
REL="NEXT"
TITLE="Some Functions Which Don't Sleep"
HREF="x584.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Unreliable Guide To Locking</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x543.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x584.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="sleeping-things"
></A
>Chapter 9. What Functions Are Safe To Call From Interrupts?</H1
><P
>&#13;      Many functions in the kernel sleep (ie. call schedule())
      directly or indirectly: you can never call them while holding a
      spinlock, or with preemption disabled.  This also means you need
      to be in user context: calling them from an interrupt is illegal.
    </P
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sleeping"
>9.1. Some Functions Which Sleep</A
></H1
><P
>&#13;      The most common ones are listed below, but you usually have to
      read the code to find out if other calls are safe.  If everyone
      else who calls it can sleep, you probably need to be able to
      sleep, too.  In particular, registration and deregistration
      functions usually expect to be called from user context, and can
      sleep.
    </P
><P
></P
><UL
><LI
><P
>&#13;        Accesses to 
        <A
HREF="g612.html#gloss-userspace"
><I
CLASS="firstterm"
>userspace</I
></A
>:
      </P
><P
></P
><UL
><LI
><P
>&#13;          <CODE
CLASS="function"
>copy_from_user()</CODE
>
        </P
></LI
><LI
><P
>&#13;          <CODE
CLASS="function"
>copy_to_user()</CODE
>
        </P
></LI
><LI
><P
>&#13;          <CODE
CLASS="function"
>get_user()</CODE
>
        </P
></LI
><LI
><P
>&#13;          <CODE
CLASS="function"
> put_user()</CODE
>
        </P
></LI
></UL
></LI
><LI
><P
>&#13;        <CODE
CLASS="function"
>kmalloc(GFP_KERNEL)</CODE
>
      </P
></LI
><LI
><P
>&#13;      <CODE
CLASS="function"
>down_interruptible()</CODE
> and
      <CODE
CLASS="function"
>down()</CODE
>
      </P
><P
>&#13;       There is a <CODE
CLASS="function"
>down_trylock()</CODE
> which can be
       used inside interrupt context, as it will not sleep.
       <CODE
CLASS="function"
>up()</CODE
> will also never sleep.
      </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x543.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x584.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Data Which Mostly Used By An IRQ Handler</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Some Functions Which Don't Sleep</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>